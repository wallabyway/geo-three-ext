<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="icon" href="data:,">
    
    <!-- Preload critical Forge Viewer resources for faster loading -->
    <link href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.113.0/viewer3D.js">
    <link href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.113.0/style.css">
    
    <link rel="stylesheet" href="https://wallabyway.github.io/floor-animation/skeleton.min.css">
    <title>(Forge) Geo-Three Extension - ES6 Modules</title>
    <style>
        body { margin: 0; overflow: hidden; display: flex; flex-direction: column; height: 100vh; }
        .navbar { flex-shrink: 0; }
        #viewer { flex: 1; position: relative; }
        
        /* Active button state - Forge Viewer doesn't provide this by default */
        .adsk-viewing-viewer .adsk-button.active {
            background-color: #0696D7 !important;
            border-color: #0696D7 !important;
        }
        .adsk-viewing-viewer .adsk-button.active .adsk-button-icon {
            color: white !important;
        }
    </style>
</head>

<body onload="init('dXJuOmFkc2sub2JqZWN0czpvcy5vYmplY3Q6Y29uc29saWRhdGVkL3JtZV9hZHZhbmNlZF9zYW1wbGVfcHJvamVjdC5ydnQ')">
    <div class="container">
        <nav class="navbar">
            <div class="container">
                <ul class="navbar-list">
                    <li class="navbar-item"><img class="navbar-button navbar-img" src="https://wallabyway.github.io/floor-animation/logo.png"/></li>
                    <li class="navbar-item"><button id="homeButton" class="navbar-button button-primary">Home</button></li>
                    <li class="navbar-itemr mobile"><a class="navbar-button button" href="https://github.com/wallabyway/geo-three-ext">Github</a></li>
                </ul>
            </div>
        </nav>
    </div>
    <div id="viewer"></div>
</body>

<link rel="stylesheet" href="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.113.0/style.css">
<script src="https://developer.api.autodesk.com/modelderivative/v2/viewers/7.113.0/viewer3D.js"></script>

<script type="module">
import './geo-three.ext.js';
import './polyline-ext.mjs';

let viewer = null;

async function initViewer(urn) {
    const token = await (await fetch("https://hd24ouudmhx7ixzla4i6so2atm0fgsex.lambda-url.us-west-2.on.aws")).text();
    const options = {
        env: 'AutodeskProduction2',
        api: 'streamingV2',
        accessToken: token
    };

    Autodesk.Viewing.Initializer(options, async () => {
        const div = document.getElementById('viewer');
        const config = {
            extensions: ['PolylineToolExtension', 'GeoThreeExtension']
        };

        viewer = new Autodesk.Viewing.Private.GuiViewer3D(div, config);
        viewer.start();
        viewer.setTheme("light-theme");
        
        document.getElementById('homeButton').addEventListener('click', () => {
            if (viewer) viewer.navigation.setRequestHomeView(true);
        });
        
        Autodesk.Viewing.Document.load(`urn:${urn}`, async (doc) => {
            const viewables = doc.getRoot().search({role:'3d', type: "geometry"})[1];
            await viewer.loadDocumentNode(doc, viewables);
        });
    });
}

window.init = initViewer;
window.viewer = viewer;
</script>

</html>

